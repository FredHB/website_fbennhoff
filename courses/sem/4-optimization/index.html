
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../3-application_stoch_proc/">
      
      
        <link rel="next" href="../5-endogenous_grid_method/">
      
      
      <link rel="icon" href="../../../assets/images/logo_white.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.32">
    
    
  
    <title>4 Optimization</title>
  

    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Serif:300,300i,400,400i,700,700i%7CIBM+Plex+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"IBM Plex Serif";--md-code-font:"IBM Plex Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction-to-equation-solving-optimization-in-python" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Frederik H Bennhoff &lt;br&gt;&lt;small&gt;&lt;i&gt;[public] finance | macroeconomics&lt;/i&gt;&lt;/small&gt;" class="md-header__button md-logo" aria-label="Frederik H Bennhoff <br><small><i>[public] finance | macroeconomics</i></small>" data-md-component="logo">
      
  <img src="../../../assets/images/logo_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Frederik H Bennhoff <br><small><i>[public] finance | macroeconomics</i></small>
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              4 Optimization
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Frederik H Bennhoff &lt;br&gt;&lt;small&gt;&lt;i&gt;[public] finance | macroeconomics&lt;/i&gt;&lt;/small&gt;" class="md-nav__button md-logo" aria-label="Frederik H Bennhoff <br><small><i>[public] finance | macroeconomics</i></small>" data-md-component="logo">
      
  <img src="../../../assets/images/logo_white.png" alt="logo">

    </a>
    Frederik H Bennhoff <br><small><i>[public] finance | macroeconomics</i></small>
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    about me
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cv/cv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cv
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/research/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    research
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    teaching & short courses
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            teaching & short courses
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    solving economic models
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            solving economic models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1-numpy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Numpy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-numba/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Numba
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-application_stoch_proc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Application: Stochastic Processes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    4 Optimization
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    4 Optimization
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-solving-systems-of-linear-equations" class="md-nav__link">
    <span class="md-ellipsis">
      1. Solving Systems of Linear Equations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-finding-roots-of-polynomial-equations" class="md-nav__link">
    <span class="md-ellipsis">
      2. Finding Roots of Polynomial Equations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-newton-methods-for-general-non-linear-equations" class="md-nav__link">
    <span class="md-ellipsis">
      3. Newton Methods for General Non-Linear Equations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Newton Methods for General Non-Linear Equations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#newtons-method" class="md-nav__link">
    <span class="md-ellipsis">
      Newton&rsquo;s Method
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Newton’s Method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-basic-idea" class="md-nav__link">
    <span class="md-ellipsis">
      1. Basic Idea
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      2. Algorithm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-application-optimal-life-time-consumption" class="md-nav__link">
    <span class="md-ellipsis">
      4. Application: Optimal Life-Time Consumption
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Application: Optimal Life-Time Consumption">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-consumption-savings-class" class="md-nav__link">
    <span class="md-ellipsis">
      A Consumption-Savings Class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-the-scipy-library-for-solving-and-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      3. The scipy Library for Solving and Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. The scipy Library for Solving and Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-basic-usage-of-scipyoptimize" class="md-nav__link">
    <span class="md-ellipsis">
      1. Basic Usage of scipy.optimize
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Basic Usage of scipy.optimize">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-finding-the-minimum-of-a-function" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Finding the Minimum of a Function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-solving-a-system-of-linear-equations" class="md-nav__link">
    <span class="md-ellipsis">
      2. Solving a System of Linear Equations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Solving a System of Linear Equations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-using-scipylinalgsolve" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Using scipy.linalg.solve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-integration-using-scipyintegrate" class="md-nav__link">
    <span class="md-ellipsis">
      3. Integration using scipy.integrate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Integration using scipy.integrate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-numerical-integration-with-quad" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Numerical Integration with quad
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-interpolation-using-scipyinterpolate" class="md-nav__link">
    <span class="md-ellipsis">
      4. Interpolation using scipy.interpolate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Interpolation using scipy.interpolate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1d-interpolation-with-interp1d" class="md-nav__link">
    <span class="md-ellipsis">
      Example: 1D Interpolation with interp1d
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-endogenous_grid_method/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 Endogenous Grid Method
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../bmetrics/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    bayesian econometrics
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            bayesian econometrics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bmetrics/BayReg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Bayesian Regression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bmetrics/UCSV/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 The Unobserved Component Stochastic Volatility Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bmetrics/TVP-AR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 The Time-Varying Parameter Model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-solving-systems-of-linear-equations" class="md-nav__link">
    <span class="md-ellipsis">
      1. Solving Systems of Linear Equations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-finding-roots-of-polynomial-equations" class="md-nav__link">
    <span class="md-ellipsis">
      2. Finding Roots of Polynomial Equations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-newton-methods-for-general-non-linear-equations" class="md-nav__link">
    <span class="md-ellipsis">
      3. Newton Methods for General Non-Linear Equations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Newton Methods for General Non-Linear Equations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#newtons-method" class="md-nav__link">
    <span class="md-ellipsis">
      Newton&rsquo;s Method
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Newton’s Method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-basic-idea" class="md-nav__link">
    <span class="md-ellipsis">
      1. Basic Idea
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      2. Algorithm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-application-optimal-life-time-consumption" class="md-nav__link">
    <span class="md-ellipsis">
      4. Application: Optimal Life-Time Consumption
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Application: Optimal Life-Time Consumption">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-consumption-savings-class" class="md-nav__link">
    <span class="md-ellipsis">
      A Consumption-Savings Class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-the-scipy-library-for-solving-and-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      3. The scipy Library for Solving and Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. The scipy Library for Solving and Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-basic-usage-of-scipyoptimize" class="md-nav__link">
    <span class="md-ellipsis">
      1. Basic Usage of scipy.optimize
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Basic Usage of scipy.optimize">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-finding-the-minimum-of-a-function" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Finding the Minimum of a Function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-solving-a-system-of-linear-equations" class="md-nav__link">
    <span class="md-ellipsis">
      2. Solving a System of Linear Equations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Solving a System of Linear Equations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-using-scipylinalgsolve" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Using scipy.linalg.solve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-integration-using-scipyintegrate" class="md-nav__link">
    <span class="md-ellipsis">
      3. Integration using scipy.integrate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Integration using scipy.integrate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-numerical-integration-with-quad" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Numerical Integration with quad
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-interpolation-using-scipyinterpolate" class="md-nav__link">
    <span class="md-ellipsis">
      4. Interpolation using scipy.interpolate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Interpolation using scipy.interpolate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1d-interpolation-with-interp1d" class="md-nav__link">
    <span class="md-ellipsis">
      Example: 1D Interpolation with interp1d
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="introduction-to-equation-solving-optimization-in-python"><strong>Introduction to Equation Solving &amp; Optimization in Python</strong><a class="headerlink" href="#introduction-to-equation-solving-optimization-in-python" title="Permanent link">#</a></h1>
<p>Python provides powerful tools and libraries for solving various types of equations, ranging from simple systems of linear equations to more complex polynomial and non-linear equations. This introduction will guide you through the basics of solving these equations using Python.</p>
<h2 id="1-solving-systems-of-linear-equations">1. <strong>Solving Systems of Linear Equations</strong><a class="headerlink" href="#1-solving-systems-of-linear-equations" title="Permanent link">#</a></h2>
<p>A system of linear equations can be represented in matrix form as <span class="arithmatex"><span class="MathJax_Preview">Ax = b</span><script type="math/tex">Ax = b</script></span>, where:</p>
<ul>
<li><span class="arithmatex"><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> is a matrix of coefficients,</li>
<li><span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> is a vector of unknowns,</li>
<li><span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span> is a vector of constants.</li>
</ul>
<p>In Python, you can solve such systems using the <code>numpy</code> library:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Coefficient matrix A</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>

<span class="c1"># Constant vector b</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>

<span class="c1"># Solving for x</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[2. 3.]
</code></pre></div>
<p><strong>Exercises:</strong></p>
<ol>
<li>Write a function <code>fit</code> taking in a np.array <code>y</code> and a matrix <code>X</code> of conformable dimensions (<span class="arithmatex"><span class="MathJax_Preview">X\in \mathbb{R}^{n\times k}</span><script type="math/tex">X\in \mathbb{R}^{n\times k}</script></span>), such that it calculates the OLS estimator <span class="arithmatex"><span class="MathJax_Preview">\hat{\beta}(X)</span><script type="math/tex">\hat{\beta}(X)</script></span>, as well as the residual vector <span class="arithmatex"><span class="MathJax_Preview">\epsilon</span><script type="math/tex">\epsilon</script></span>. Do not solve the normal equations with a matrix inverse, but use <code>np.linalg.solve</code>.</li>
<li>Write a function <code>robust</code> which calculates the sandwich estimator: </li>
</ol>
<div class="arithmatex">
<div class="MathJax_Preview">n\text{Var}(\hat{\beta})_{\text{robust}} = (X'X)^{-1} \left( \sum_{i=1}^n X_i' \hat{\epsilon}_i^2 X_i \right) (X'X)^{-1}</div>
<script type="math/tex; mode=display">n\text{Var}(\hat{\beta})_{\text{robust}} = (X'X)^{-1} \left( \sum_{i=1}^n X_i' \hat{\epsilon}_i^2 X_i \right) (X'X)^{-1}</script>
</div>
<ol>
<li>Write a <code>class</code> called <code>olsmodel</code> which holds <code>y</code> and <code>X</code>, and which contains methods <code>fit</code>, <code>robust</code> and <code>predict</code></li>
</ol>
<p><strong>Solution</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">sim_some_data</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">ncov</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">ncov</span><span class="p">))</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">ncov</span><span class="p">)</span>
    <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="n">beta</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">ncov</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">beta</span> 

<span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">sim_some_data</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="n">beta_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">y</span> <span class="p">)</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">X</span> <span class="o">@</span> <span class="n">beta_hat</span>
    <span class="k">return</span> <span class="n">beta_hat</span><span class="p">,</span> <span class="n">resid</span>

<span class="n">beta_hat</span><span class="p">,</span> <span class="n">resid</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">robust</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">resid</span><span class="p">):</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="c1"># we prefer using a loop over using residuals on a diagonal matrix, so we don&#39;t have to instantiate a NxN matrix </span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span>  <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="p">(</span><span class="n">resid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">XpX_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X</span><span class="p">)</span>

    <span class="n">sw</span> <span class="o">=</span> <span class="p">(</span><span class="n">XpX_inv</span> <span class="o">@</span> <span class="nb">sum</span> <span class="o">@</span> <span class="n">XpX_inv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sw</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">robust</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">resid</span><span class="p">)</span>

<span class="c1">## Or an alternative version using no matrix inversion:</span>
<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">robust_linalg</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">resid</span><span class="p">):</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="c1"># we prefer using a loop over using residuals on a diagonal matrix, so we don&#39;t have to instantiate a NxN matrix </span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span>  <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="p">(</span><span class="n">resid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">XpX</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X</span>

    <span class="c1"># steps:</span>
    <span class="c1"># XpX @ sw @ XpX = sum</span>
    <span class="n">sw_XpX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">XpX</span> <span class="p">,</span> <span class="nb">sum</span><span class="p">)</span>

    <span class="c1"># steps:</span>
    <span class="c1"># sw @ XpX = sw_XpX</span>
    <span class="c1"># XpX.T @ sw.T = sw_XpX.T</span>
    <span class="n">sw_T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">XpX</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">sw_XpX</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="c1"># transpose of sandwich sw (but sw is diagonal)</span>

    <span class="k">return</span> <span class="n">sw_T</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">robust_linalg</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">resid</span><span class="p">)</span> <span class="c1"># compile function and throw result away</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">timeit</span> <span class="n">robust</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">resid</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">robust_linalg</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">resid</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>1.3 s ± 88.9 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
1.21 s ± 45.2 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</code></pre></div>
<h2 id="2-finding-roots-of-polynomial-equations">2. <strong>Finding Roots of Polynomial Equations</strong><a class="headerlink" href="#2-finding-roots-of-polynomial-equations" title="Permanent link">#</a></h2>
<p>For polynomial equations, Python’s <code>numpy</code> library offers straightforward methods to find roots. For example, to solve a polynomial equation like <span class="arithmatex"><span class="MathJax_Preview">ax^2 + bx + c = 0</span><script type="math/tex">ax^2 + bx + c = 0</script></span>. 
This code computes the roots of the quadratic equation <span class="arithmatex"><span class="MathJax_Preview">x^2 - 3x + 2 = 0</span><script type="math/tex">x^2 - 3x + 2 = 0</script></span>, which are the values of <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> that satisfy the equation.</p>
<div class="highlight"><pre><span></span><code><span class="n">coefficients</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Coefficients of x^2 - 3x + 2</span>
<span class="n">roots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[2. 1.]
</code></pre></div>
<p><strong>Exercise:</strong> Write a function <code>IRR</code> to calculate the internal rate of return of a payment stream. The function takes as arguments a stream of future payments <span class="arithmatex"><span class="MathJax_Preview">x_1,...,x_n</span><script type="math/tex">x_1,...,x_n</script></span> and an initial payment <span class="arithmatex"><span class="MathJax_Preview">C_0</span><script type="math/tex">C_0</script></span>, and finds the roots of the equation $$ C_0 = \sum_i x_i (1+r)^{-i}.$$
It then checks which of the roots <span class="arithmatex"><span class="MathJax_Preview">\{r_1,...,r_n\}</span><script type="math/tex">\{r_1,...,r_n\}</script></span> are real, and picks among those the internal rate of return. Does the function work well for large <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>?</p>
<div class="highlight"><pre><span></span><code><span class="n">C_0</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Initial investment</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">55</span><span class="p">])</span>  <span class="c1"># Cash flows, the last payment comes last in this sequence</span>

<span class="k">def</span> <span class="nf">IRR</span><span class="p">(</span><span class="n">C_0</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="c1"># Reverse the cash flows array to match the polynomial root finding convention</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># Create the coefficients array for the polynomial equation</span>
    <span class="n">coefficients</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">C_0</span><span class="p">]])</span>

    <span class="c1"># Find the roots of the polynomial equation</span>
    <span class="n">roots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)</span>

    <span class="c1"># Filter out the complex roots, keep only real roots</span>
    <span class="n">is_real_solution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span> <span class="o">==</span> <span class="n">roots</span>
    <span class="n">roots</span> <span class="o">=</span> <span class="n">roots</span><span class="p">[</span><span class="n">is_real_solution</span><span class="p">]</span>
    <span class="n">roots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>

    <span class="c1"># Calculate IRR candidates from the real roots</span>
    <span class="n">IRR_candidates</span> <span class="o">=</span> <span class="n">roots</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># Filter out IRR candidates that are greater than -1</span>
    <span class="n">IRR</span> <span class="o">=</span> <span class="n">IRR_candidates</span><span class="p">[</span><span class="n">IRR_candidates</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Return the IRR if there is a unique solution, otherwise print a message</span>
    <span class="k">if</span> <span class="n">IRR</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IRR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;non-unique IRR&quot;</span><span class="p">)</span>

<span class="c1"># Call the IRR function with the initial investment and cash flows</span>
<span class="n">IRR</span><span class="p">(</span><span class="n">C_0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>0.1280272166910017
</code></pre></div>
<h2 id="3-newton-methods-for-general-non-linear-equations">3. <strong>Newton Methods for General Non-Linear Equations</strong><a class="headerlink" href="#3-newton-methods-for-general-non-linear-equations" title="Permanent link">#</a></h2>
<p>We now try to understand Newton&rsquo;s workhorse optimization routine.</p>
<h3 id="newtons-method">Newton&rsquo;s Method<a class="headerlink" href="#newtons-method" title="Permanent link">#</a></h3>
<h4 id="1-basic-idea">1. <strong>Basic Idea</strong><a class="headerlink" href="#1-basic-idea" title="Permanent link">#</a></h4>
<p>Newton&rsquo;s method iteratively approximates the root of a function using the following update rule:</p>
<div class="arithmatex">
<div class="MathJax_Preview"> x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)} </div>
<script type="math/tex; mode=display"> x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)} </script>
</div>
<p>where:</p>
<ul>
<li><span class="arithmatex"><span class="MathJax_Preview">x_n</span><script type="math/tex">x_n</script></span> is the current estimate of the root.</li>
<li><span class="arithmatex"><span class="MathJax_Preview">f'(x_n)</span><script type="math/tex">f'(x_n)</script></span> is the derivative (or Jacobian, in the multivariate case) of <span class="arithmatex"><span class="MathJax_Preview">f(x)</span><script type="math/tex">f(x)</script></span> at <span class="arithmatex"><span class="MathJax_Preview">x_n</span><script type="math/tex">x_n</script></span>.</li>
</ul>
<h4 id="2-algorithm">2. <strong>Algorithm</strong><a class="headerlink" href="#2-algorithm" title="Permanent link">#</a></h4>
<ol>
<li><strong>Start with an initial guess</strong> <span class="arithmatex"><span class="MathJax_Preview">x_0</span><script type="math/tex">x_0</script></span>.</li>
<li><strong>Compute the function value</strong> <span class="arithmatex"><span class="MathJax_Preview">f(x_n)</span><script type="math/tex">f(x_n)</script></span> and its derivative <span class="arithmatex"><span class="MathJax_Preview">f'(x_n)</span><script type="math/tex">f'(x_n)</script></span>.</li>
<li><strong>Update the estimate</strong> using the formula <span class="arithmatex"><span class="MathJax_Preview">x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)}</span><script type="math/tex">x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)}</script></span>.</li>
<li><strong>Repeat</strong> until the change in <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> is smaller than a specified tolerance, or the function value <span class="arithmatex"><span class="MathJax_Preview">f(x_n)</span><script type="math/tex">f(x_n)</script></span> is sufficiently close to zero.</li>
</ol>
<p><strong>Exercise:</strong> With pen and paper, prove that Newton&rsquo;s method converges in one step for any linear equation <span class="arithmatex"><span class="MathJax_Preview">Ax = b</span><script type="math/tex">Ax = b</script></span></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>

<span class="c1"># varaible intercept for equation below</span>
<span class="n">interc</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">def</span> <span class="nf">equation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">interc</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">x</span> <span class="o">+</span> <span class="n">interc</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;roots found by numpy:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span> <span class="n">interc</span><span class="p">]))</span>

<span class="n">initial_guess</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
<span class="n">x_root</span><span class="p">,</span> <span class="n">fsolve_dict</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">interc</span><span class="p">),</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fsolve_dict</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span><span class="n">equation</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">interc</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y=0&#39;</span><span class="p">)</span>  <span class="c1"># Add horizontal line at y=0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_root</span><span class="p">,</span> <span class="n">equation</span><span class="p">(</span><span class="n">x_root</span><span class="p">,</span> <span class="n">interc</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Plot of the Equation with Horizontal Line at y=0&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Note that the fsolve routine gets stuck for initial values in the region (-1, 1).&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>roots found by numpy: [-1.90416086+0.j          0.95208043+1.31124804j  0.95208043-1.31124804j]
{&#39;nfev&#39;: 7, &#39;fjac&#39;: array([[-1.]]), &#39;r&#39;: array([-9.87749]), &#39;qtf&#39;: array([1.12003029e-09]), &#39;fvec&#39;: array([0.])}
</code></pre></div>
<p><img alt="png" src="../4-optimization_files/4-optimization_15_1.png" /></p>
<div class="highlight"><pre><span></span><code>Note that the fsolve routine gets stuck for initial values in the region (-1, 1).
</code></pre></div>
<p>Let&rsquo;s write a multivariate Newton solver able to solve equations of type <span class="arithmatex"><span class="MathJax_Preview">F(x)=0, \; F: \mathbb{R}^n \rightarrow \mathbb{R}^n</span><script type="math/tex">F(x)=0, \; F: \mathbb{R}^n \rightarrow \mathbb{R}^n</script></span>. The solver should take as inputs a funtion to solve, <code>f</code>, a vector <code>x0</code> as a starting point, and a tolerance level <code>tol</code> for convergence, as well as a <code>maxiter</code> number of iterations after which it stops the solution process.
We proceed in a few steps, in particular, first we need a method to obtain the jacobian, <code>Jf</code> at an arbitrary point:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># example function I</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
        <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">5</span>
    <span class="p">])</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>

<span class="c1"># # example function II</span>
<span class="c1"># def f(x):</span>
<span class="c1">#     return np.array([</span>
<span class="c1">#         x[0]**2, </span>
<span class="c1">#         x[1]**5</span>
<span class="c1">#     ])</span>
<span class="c1"># x0 = np.array([1., 1.])</span>

<span class="c1"># # example function III</span>
<span class="c1"># def f(x):</span>
<span class="c1">#     return np.array([</span>
<span class="c1">#         x[0]**2</span>
<span class="c1">#     ])</span>
<span class="c1"># x0 = np.array([1.])</span>

<span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>array([3., 0.])
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># run-off-the-mill method to calculate a jacobian numerically</span>
<span class="k">def</span> <span class="nf">jacobian</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">):</span>

    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span> 

    <span class="n">fx0</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
    <span class="n">M</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="o">*</span><span class="n">fx0</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">*</span><span class="n">x0</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">Jf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1E-8</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">x_eps</span> <span class="o">=</span> <span class="n">x0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">x_eps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">epsilon</span>
        <span class="n">Jf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_eps</span><span class="p">)</span> <span class="o">-</span> <span class="n">fx0</span><span class="p">)</span> <span class="o">/</span> <span class="n">epsilon</span>

    <span class="k">return</span> <span class="n">Jf</span>

<span class="c1"># test the function</span>
<span class="n">jacobian</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>array([[ 1.99999999,  5.00000008],
       [ 3.99999998, -0.99999999]])
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># newton solver</span>
<span class="k">def</span> <span class="nf">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="mf">1E-12</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">1_000</span><span class="p">):</span>

    <span class="n">x_old</span> <span class="o">=</span> <span class="n">x0</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">x_old</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">Jf</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x_old</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxiter</span><span class="p">):</span>

        <span class="n">x_old</span> <span class="o">=</span> <span class="n">x_new</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">f_old</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f_old</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span> <span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;convergence achieved after </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> iterations&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">f_old</span><span class="p">,</span> <span class="n">Jf</span>

        <span class="n">Jf</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x_old</span><span class="p">)</span>
        <span class="c1">#print(f_old)</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">x_old</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Jf</span><span class="p">)</span> <span class="o">@</span> <span class="n">f_old</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;convergence not achieved&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x_old</span><span class="p">,</span> <span class="n">f_old</span><span class="p">,</span> <span class="n">Jf</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># it works!</span>
<span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">10_000</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>convergence achieved after 124 iterations





(array([0.804978  , 0.33800261]),
 array([-8.11350986e-13,  1.27675648e-13]),
 array([[ 1.60995601,  2.09945251],
        [ 4.        , -1.        ]]))
</code></pre></div>
<p><strong>Exercise:</strong> Secant Method</p>
<p>The Secant method is a derivative-free variation of Newton&rsquo;s method. Instead of using the exact derivative <span class="arithmatex"><span class="MathJax_Preview">f'(x)</span><script type="math/tex">f'(x)</script></span>, it approximates the derivative using two recent points:</p>
<div class="arithmatex">
<div class="MathJax_Preview">
x_{n+1} = x_n - f(x_n) \frac{x_n - x_{n-1}}{f(x_n) - f(x_{n-1})}
</div>
<script type="math/tex; mode=display">
x_{n+1} = x_n - f(x_n) \frac{x_n - x_{n-1}}{f(x_n) - f(x_{n-1})}
</script>
</div>
<ul>
<li><strong>Advantages</strong>: Does not require computing derivatives, which can be advantageous when the derivative is difficult to calculate.</li>
<li><strong>Disadvantages</strong>: Typically converges more slowly than Newton&rsquo;s method.</li>
</ul>
<p>Write a univariate root solver <code>secant_newton</code> in the spirit of the <code>newton</code> solver we just developed, which uses the secant method. </p>
<h2 id="4-application-optimal-life-time-consumption">4. <strong>Application: Optimal Life-Time Consumption</strong><a class="headerlink" href="#4-application-optimal-life-time-consumption" title="Permanent link">#</a></h2>
<p>Let&rsquo;s use the solver we just wrote to solve a class of simple optimal consumption problems. In <span class="arithmatex"><span class="MathJax_Preview">T</span><script type="math/tex">T</script></span> periods, an agent can decide to save or consume, given an initial endowment <span class="arithmatex"><span class="MathJax_Preview">\omega</span><script type="math/tex">\omega</script></span> and some income <span class="arithmatex"><span class="MathJax_Preview">y_t</span><script type="math/tex">y_t</script></span>, which varies every period.</p>
<div class="arithmatex">
<div class="MathJax_Preview">
 U = \sum_{0\leq t \leq T-1} \beta^t \log(c_t), \text{  s.t.  } a_{t+1} = y_t + a_t*(1+r) - c_t,\; a_{-1} = \omega,\; a_{T} \geq 0 
</div>
<script type="math/tex; mode=display">
 U = \sum_{0\leq t \leq T-1} \beta^t \log(c_t), \text{  s.t.  } a_{t+1} = y_t + a_t*(1+r) - c_t,\; a_{-1} = \omega,\; a_{T} \geq 0 
</script>
</div>
<p>Giving us FOCs:
$$
\begin{equation<em>}
    f_0(\omega, a_0, a_1) = 0, 
\end{equation</em>}
$$</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\begin{equation*}
    f_t(a_{t-1}, a_t, a_{t+1}) \equiv \beta (1+r) ( y_{t-1} + a_{t-1}(1+r) - a_t ) - ( y_t + a_t(1+r) -a_{t+1}) = 0 ,\; \forall 1 \leq t \leq T-2 
\end{equation*}
</div>
<script type="math/tex; mode=display">
\begin{equation*}
    f_t(a_{t-1}, a_t, a_{t+1}) \equiv \beta (1+r) ( y_{t-1} + a_{t-1}(1+r) - a_t ) - ( y_t + a_t(1+r) -a_{t+1}) = 0 ,\; \forall 1 \leq t \leq T-2 
\end{equation*}
</script>
</div>
<div class="arithmatex">
<div class="MathJax_Preview">
\begin{equation*}
    f_{T-2}(a_{T-2}, a_{T-1}, 0) =0 
\end{equation*}
</div>
<script type="math/tex; mode=display">
\begin{equation*}
    f_{T-2}(a_{T-2}, a_{T-1}, 0) =0 
\end{equation*}
</script>
</div>
<p>to solve simultaneously by choosing <span class="arithmatex"><span class="MathJax_Preview">a_0, ..., a_{T-1}</span><script type="math/tex">a_0, ..., a_{T-1}</script></span>. We could do this in a recursive way, but lets attack the FOCs directly.</p>
<div class="highlight"><pre><span></span><code><span class="n">beta</span> <span class="o">=</span> <span class="mf">0.98</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># y has T elements </span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># a_choice has T elements </span>
<span class="n">a_choice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">F</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a_choice</span><span class="p">):</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span> <span class="c1"># accommodate initial and terminal condition</span>
    <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_choice</span>

    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">omega</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">-</span> <span class="p">(</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">F</span><span class="p">)):</span>
        <span class="n">F</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="p">)</span> <span class="o">-</span> <span class="p">(</span> <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">F</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">F</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a_choice</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>array([4.10204082, 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ])
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># try the function</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F =&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">F</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">omega</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">a_choice</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Does it jacobe? Yes, it does!</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a_choice</span> <span class="p">:</span> <span class="n">F</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a_choice</span><span class="p">),</span> <span class="n">a_choice</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="c1"># check that the jacobian is not ill conditioned</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>F = [4.10204082 0.         0.         0.         0.         0.
 0.         0.         0.         0.        ]
</code></pre></div>
<p>Let&rsquo;s try whether this works out, and whether our solver can find a sequence of assets <span class="arithmatex"><span class="MathJax_Preview">a = (a_0, ..., a_{T-1})</span><script type="math/tex">a = (a_0, ..., a_{T-1})</script></span> to solve the first order conditions:</p>
<div class="highlight"><pre><span></span><code><span class="n">a_choices</span><span class="p">,</span> <span class="n">F_values</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a_choice</span> <span class="p">:</span> <span class="n">F</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a_choice</span><span class="p">),</span> <span class="n">a_choice</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">10_000</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>convergence achieved after 10 iterations
</code></pre></div>
<p>Indeed, we have solved the consumption-savings problem with the output of our Newton-solver. Let&rsquo;s plot these results in a figure.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Plot the asset path</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a_choices</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Asset Path in Consumption-Savings Problem&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time Period&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Assets&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../4-optimization_files/4-optimization_29_0.png" /></p>
<p><strong>Looks great!</strong></p>
<h3 id="a-consumption-savings-class">A Consumption-Savings Class<a class="headerlink" href="#a-consumption-savings-class" title="Permanent link">#</a></h3>
<p>Now let&rsquo;s go all in and package the problem nicely. We write a class <code>ConSavProb</code> which takes as inputs <code>beta, r, y, omega</code> and an initial guess for <code>a</code>. It has a <code>solve</code> method, which solves for the optimal asset and consumption path.</p>
<p>Packaging the consumption-savings problem into a class, in this case <code>ConSavProb</code>, offers several benefits:</p>
<ol>
<li>
<p><strong>Modularity</strong>: By encapsulating the problem within a class, we can organize related variables and functions together. This improves code organization and makes it easier to understand and maintain. It also allows us to reuse the class in different parts of our code or even in other projects.</p>
</li>
<li>
<p><strong>Abstraction</strong>: Instead of exposing all the inner workings of the consumption-savings problem, we can provide a clean interface through class methods. </p>
</li>
<li>
<p><strong>Encapsulation</strong>: Classes allow us to encapsulate data and methods together. This means that the variables and functions related to the consumption-savings problem are contained within the class, reducing the chances of naming conflicts with other parts of the codebase. It also provides a clear boundary for the problem, making it easier to reason about and test.</p>
</li>
<li>
<p><strong>Code Reusability</strong>: Once we have defined the <code>ConSavProb</code> class, we can create multiple instances of it with different input parameters.</p>
</li>
<li>
<p><strong>Readability</strong>: Using a class can improve the readability of the code. </p>
</li>
</ol>
<p>Overall, using a class to package the consumption-savings problem provides a clean, modular, and reusable solution that enhances code organization, abstraction, and readability.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ConSavProb</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class representing a consumption-savings problem.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        beta (float): The discount factor.</span>
<span class="sd">        r (float): The interest rate.</span>
<span class="sd">        y (float): The income.</span>
<span class="sd">        omega (float): The initial endowment.</span>
<span class="sd">        asset_path (numpy.ndarray): The path of assets over time.</span>
<span class="sd">        a_guess (float): The initial guess for assets.</span>
<span class="sd">        euler_error (float): The Euler equation error.</span>
<span class="sd">        solved (bool): Indicates whether the problem has been solved.</span>

<span class="sd">    Methods:</span>
<span class="sd">        update_parameters: Update the parameters of the problem.</span>
<span class="sd">        solve_asset_path: Solve the consumption-savings problem and compute the asset path.</span>
<span class="sd">        plot_asset_path: Plot the asset path.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">omega</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a ConSavProb object.</span>

<span class="sd">        Args:</span>
<span class="sd">            beta (float): The discount factor.</span>
<span class="sd">            r (float): The interest rate.</span>
<span class="sd">            y (float): The income.</span>
<span class="sd">            omega (float): The probability of receiving income.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">asset_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">euler_error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solved</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the parameters of the problem.</span>

<span class="sd">        Args:</span>
<span class="sd">            beta (float, optional): The discount factor.</span>
<span class="sd">            r (float, optional): The interest rate.</span>
<span class="sd">            y (float, optional): The income.</span>
<span class="sd">            omega (float, optional): The probability of receiving income.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">if</span> <span class="n">omega</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>

    <span class="k">def</span> <span class="nf">solve_asset_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_guess</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solve the consumption-savings problem and compute the asset path.</span>

<span class="sd">        Args:</span>
<span class="sd">            a_guess (float): The initial guess for assets.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">a_guess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

        <span class="c1"># solve</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">asset_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">euler_error</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FOC</span><span class="p">,</span> <span class="n">a_guess</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">10_000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solved</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">FOC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_choice</span><span class="p">):</span>
        <span class="n">beta</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>  <span class="c1"># unpack the parameters</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span> <span class="c1"># accommodate initial and terminal condition</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_choice</span>

        <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">omega</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">-</span> <span class="p">(</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">F</span><span class="p">)):</span>
            <span class="n">F</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="p">)</span> <span class="o">-</span> <span class="p">(</span> <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">F</span>

    <span class="k">def</span> <span class="nf">plot_asset_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the asset path.</span>

<span class="sd">        Args:</span>
<span class="sd">            figsize (tuple, optional): The figure size. Defaults to (10, 6).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solved</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Plot the asset path</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">asset_path</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]]),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                     <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Asset Path in Consumption-Savings Problem&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time Period&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Assets&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="n">ConSavProb</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">omega</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">solve_asset_path</span><span class="p">(</span><span class="n">a_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="n">model</span><span class="o">.</span><span class="n">plot_asset_path</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>convergence achieved after 10 iterations
</code></pre></div>
<p><img alt="png" src="../4-optimization_files/4-optimization_33_1.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="mf">0.85</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">solve_asset_path</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">asset_path</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot_asset_path</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>convergence achieved after 30 iterations
</code></pre></div>
<p><img alt="png" src="../4-optimization_files/4-optimization_34_1.png" /></p>
<p>What, if income were decreasing from <span class="arithmatex"><span class="MathJax_Preview">6</span><script type="math/tex">6</script></span> to <span class="arithmatex"><span class="MathJax_Preview">1</span><script type="math/tex">1</script></span> over time, and we had <span class="arithmatex"><span class="MathJax_Preview">T=20</span><script type="math/tex">T=20</script></span> periods instead?</p>
<div class="highlight"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.85</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">solve_asset_path</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot_asset_path</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>convergence achieved after 149 iterations
</code></pre></div>
<p><img alt="png" src="../4-optimization_files/4-optimization_36_1.png" /></p>
<h2 id="3-the-scipy-library-for-solving-and-optimization">3. The <strong><code>scipy</code> Library for Solving and Optimization</strong><a class="headerlink" href="#3-the-scipy-library-for-solving-and-optimization" title="Permanent link">#</a></h2>
<p>For more complex equations, including non-linear systems, Python’s <code>scipy</code> library provides powerful tools. </p>
<h3 id="1-basic-usage-of-scipyoptimize">1. Basic Usage of <code>scipy.optimize</code><a class="headerlink" href="#1-basic-usage-of-scipyoptimize" title="Permanent link">#</a></h3>
<h4 id="example-finding-the-minimum-of-a-function">Example: Finding the Minimum of a Function<a class="headerlink" href="#example-finding-the-minimum-of-a-function" title="Permanent link">#</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>

<span class="c1"># Define the function to minimize</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Initial guess</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># Perform the minimization</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimum value:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;At x =&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Minimum value: -3.2463942726915187
At x = [-1.11051058]
</code></pre></div>
<h3 id="2-solving-a-system-of-linear-equations">2. Solving a System of Linear Equations<a class="headerlink" href="#2-solving-a-system-of-linear-equations" title="Permanent link">#</a></h3>
<h4 id="example-using-scipylinalgsolve">Example: Using <code>scipy.linalg.solve</code><a class="headerlink" href="#example-using-scipylinalgsolve" title="Permanent link">#</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">solve</span>

<span class="c1"># Coefficient matrix</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>

<span class="c1"># Right-hand side vector</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># Solve the system</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Solution:&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Solution: [ 1.  -0.5]
</code></pre></div>
<h3 id="3-integration-using-scipyintegrate">3. Integration using <code>scipy.integrate</code><a class="headerlink" href="#3-integration-using-scipyintegrate" title="Permanent link">#</a></h3>
<h4 id="example-numerical-integration-with-quad">Example: Numerical Integration with <code>quad</code><a class="headerlink" href="#example-numerical-integration-with-quad" title="Permanent link">#</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>

<span class="c1"># Define the function to integrate</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Perform the integration</span>
<span class="n">result</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integral result:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estimated error:&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Integral result: 0.7468241328124271
Estimated error: 8.291413475940725e-15
</code></pre></div>
<h3 id="4-interpolation-using-scipyinterpolate">4. Interpolation using <code>scipy.interpolate</code><a class="headerlink" href="#4-interpolation-using-scipyinterpolate" title="Permanent link">#</a></h3>
<h4 id="example-1d-interpolation-with-interp1d">Example: 1D Interpolation with <code>interp1d</code><a class="headerlink" href="#example-1d-interpolation-with-interp1d" title="Permanent link">#</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>

<span class="c1"># Sample data points</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Create the interpolating function</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>

<span class="c1"># Interpolated values</span>
<span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_new</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>

<span class="c1"># Plot the results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data points&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;cubic interpolation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../4-optimization_files/4-optimization_45_0.png" /></p>
<p>These examples should give you a good starting point for using <code>scipy</code> in various scientific and technical computing tasks.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.top", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.471ce7a9.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>